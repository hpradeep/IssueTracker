
<div class="container index">
<h1> Issues</h1>
<table class="table table-inverse">
<thead> 
<tr>
	<th>Title</th>
	<th>Description</th>
	<th>Created at</th>

	<th colspan="3"></th>
	
</tr>
</thead>
<tbody id="tbody">

<%@issues.each do |issue|%>
<tr>
<td><%=issue.title %></td>
<td><%=issue.description %></td>
<td><%=time_ago_in_words(issue.created_at)%> ago</td>
<td><%=link_to 'View Comments','#',class: "btn btn-sm btn-default viewcomment",data: {id: issue.id,title: issue.title}%></td>
<td><%=link_to 'Edit','#',class: "btn btn-sm btn-default edit",data: {id: issue.id,title: issue.title,description: issue.description} %></td>
<td><%=link_to 'Destroy',issue,method: :delete,data: {confirm: 'Are you sure?'},class: "btn btn-sm btn-default delete"%></td>
</tr>
<%end%>
</tbody>
</table>
<p><%=link_to "New issue",'#',class: "new_issue btn btn-sm btn-success"%></p>


</div>


<div class="container newissue">
<h1>New Issue</h1>
<p><%=form_for(@issue) do |f| %></p>
<p><%= f.text_field :title,placeholder: :title,class: "form-control"%></p>
<p><%= f.text_area :description,placeholder: :description,class: "form-control"%></p>
<p><%=link_to"CreateIssue",'#',class: "submit btn btn-sm btn-default"%>
<%=link_to 'Back','#',class: "btn btn-sm btn-default back"%></p>

<%end%>
</div>
<div class ="container" id = "comments">
<h1 id="title">comments for issue</h1>
<table class="table table-inverse">
	<thead>
		<tr>
		<th>Comments</th>
		<th>Created at</th>
		<th colspan="3"></th>
		</tr>
	</thead>
	<tbody id="issuecomment">
	</tbody>
	<h3 id="nocomments"></h3>
</table>
<input type="hidden" id="hidden-issue-id"><br>
<form>
<h6>Post your comment</h6>
<p><textarea class="form-control" id="commn" placeholder="leave your comment here"></textarea> </p> 
<p><a class="btn btn-sm btn-default createcomment" href="#">Post</a>
<a class="btn btn-sm btn-default b2i" href="#">Cancel</a></p>
</form>
</div>




<% content_for :javascript do %>

<script>
	$(document).ready(function(){
		$(".newissue").hide();
		$("#comments").hide();
		
		$(".new_issue").on("click",function(){
       		$(".index").hide();
			$(".newissue").show();
			
			
       	});
       	$(".back").click(function(){
       		$(".newissue").hide(function(){
       		 $(".index").show();	
       		});
		});
		$(".submit").click(function(){
			var title = $("#issue_title").val();
			var description = $("#issue_description").val();
			 if (title != '' && description != '') {
			$.ajax({
				url: "/issues",
				type: "POST",
				data:{'issue': {'title': title,'description': description}}
			}).done(function(response){
				
              var html ="<tr><td>"+response.title+"</td>";
                  html += "<td>"+response.description+"</td>";
                  html +="<td>"+response.created_at+"</td>";
                  html +="<td><a class='btn btn-sm btn-default comment' href='/issues/"+response.id+"/comments'>View Comments</a></td>";
                  html +="<td><a class='btn btn-sm btn-default edit' href='/issues/"+response.id+"/edit'>Edit</a></td>";
                  html +="<td><a class='btn btn-sm btn-default delete' href='/issues/"+response.id+" data-method='delete' rel='nofollow' data-confirm='Are you sure?'>Destroy</a></td>";
                  $("#tbody").append(html);
                  $(".index").show();
                  $(".newissue").hide();
                  $("#issue_title").val("");
			      $("#issue_description").val("");

                 });
			
            }
			else{
				alert("Fill out the fields");
			    }
			
        });
            
            $(".viewcomment").click(function(){
            	var issueid = $(this).data("id");
            	$("#hidden-issue-id").val(issueid);

            	var  issuetitle = $(this).data("title"); 
            	$.ajax({
            		url: "/issues/"+issueid+"/comments",
            		type: "GET",
            	    }).done(function(response){
            	    	  var html = "";
            	     	if (response.length > 0){
            	     		for (i in response){
            	     		console.log(response);

	            	     	 html +="<tr><td>"+response[i].comment+"</td>";
	            	     	 html += "<td>"+response[i].created_at+"</td>";
	            	     	 html += "<td><a class='btn btn-sm btn-default commentedit' href='#'>Edit</a></td>";
	            	     	 html += "<td><a class='btn btn-sm btn-default commentdelete' href='#' data-confirm='Are You sure'>Destroy</td></tr>";
	            	     	}

	            		    $(".index").hide(function(){
	            		    $("#comments").show();
	            		    $("#title").html("comments for issue:#"+issuetitle);
	            		    $("#nocomments").html("");
	            			$("#issuecomment").append(html);
	            			});	
            	     	}
            	     	else{
                            
                        $(".index").hide();
            		    $("#comments").show();
            		    $("#title").html("comments for issue:#"+issuetitle);
            		    $("#nocomments").html("No comments yet");
            		    }
            	     	
                   });
            });
                $(".createcomment").click(function(){
                  	var comment = $("#commn").val();
                  	var hidissuid = $("#hidden-issue-id").val();
                  	if (comment != ''){
                       $.ajax({
                       	url: "/issues/"+hidissuid+"/comments",
                       	type:"POST",
                       	data:{'comment':{'comment': comment}}
                       }).done(function(response){
                         var html ="<tr><td>"+response.comment+"</td>";
                          html  +="<td>"+response.created_at+"</td>";
                          html += "<td><a class='btn btn-sm btn-default commentedit' href='#'>Edit</a></td>";
	            	     	 html += "<td><a class='btn btn-sm btn-default commentdelete' href='#' data-confirm='Are You sure'>Destroy</td></tr>";
	            	     	 $("#issuecomment").append(html);
	            	     	 $("#comments").show();
	            	     	 $("#nocomments").html("");
	            	     	 $("#commn").val("");
                            });
                       
                  	}
                  	else{
                  		alert("enter your comments");
                  	}
                  });
              
              
});
</script>
<%end%>

